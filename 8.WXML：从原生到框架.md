### Web 开发深度探索笔记：从原生到框架

#### 1. 微信小程序：WXML vs HTML

小程序选择自研 WXML 而非 HTML，本质是为了在**受限环境下实现高性能与高安全**。

- **双线程架构：** 逻辑层（JS）与视图层（WXML/WXSS）物理隔离，通过微信中转。
- **禁用法术：** 禁止直接操作 DOM 和 BOM，防止开发者触碰微信底层的私有属性。
- **原生渲染：** 部分 WXML 标签（如 `<video>`、`<map>`）在底层会被替换为系统级原生组件，性能碾压网页。

------

#### 2. 渲染性能：为什么不直接用 `innerHTML`？

虽然 `innerHTML` 拥有浏览器原生的解析速度，但在现代开发中存在致命缺陷：

- **全量覆盖：** 每次修改都会销毁并重建整个 DOM 树，导致状态（如滚动位置、视频播放、输入框焦点）丢失。
- **性能反噬：** 频繁的重绘（Repaint）和回流（Reflow）成本远高于 JavaScript 计算。
- **安全黑洞：** 极易受到 XSS 注入攻击。
- **框架方案：** **虚拟 DOM (Virtual DOM)** 通过 Diff 算法实现“精确打击”，只修改变动的最小单元。

------

#### 3. 浏览器原生能力的回归 (Web Components)

随着 Web 标准的进化，原生 API 正在逐步取代过去必须依赖重型框架（React/Vue/jQuery）的功能。

- **Web Components：**
  - `Custom Elements`: 定义自定义标签。
  - `Shadow DOM`: 实现真正的**样式与结构隔离**，外部 CSS 无法污染组件内部。
  - `Templates`: 原生模板支持。
- **其他替代：**
  - **CSS 变量 (`--var`)**: 配合 `setProperty` 实现高性能主题切换。
  - **Fetch API**: 替代 Ajax/Axios。
  - **CSS Grid/Flexbox**: 替代 Bootstrap 栅格系统。

------

#### 4. JS 三大核心：公寓模型理解法

| **核心**            | **形象比喻**       | **职责范围**                                      |
| ------------------- | ------------------ | ------------------------------------------------- |
| **ECMAScript (ES)** | 公寓的设计图纸     | 变量、循环、异步逻辑、对象处理。                  |
| **DOM**             | 公寓里的家具装修   | 网页内容的增删改查。                              |
| **BOM**             | 公寓所在的大楼环境 | 窗口大小、地址栏 (location)、历史记录 (history)。 |

> **小程序的核心差异：** 仅保留了 ES，彻底移除了 DOM 和 BOM，改用微信提供的原生 API (wx.xxx)。

------

#### 5. 安全深度：为什么封杀 DOM/BOM？

微信隔离开发者对 DOM 的访问，是为了构建一套**“特权隔离”**机制：

- **防止 UI 劫持：** 避免恶意开发者在原生支付按钮上覆盖透明层（钓鱼攻击）。
- **隐私屏障：** 微信环境包含支付、社交等高权限数据。若开放 DOM，开发者可能窃取微信内核的敏感 Token 或模拟系统弹窗。
- **对比浏览器：** 浏览器依靠**同源策略 (SOP)** 保护不同网站。微信则作为宿主，必须通过**双线程物理隔离**来确保其“地盘”内的绝对安全。

------

#### 6. 系统级交互：如何突破沙盒？

普通 HTML 运行在浏览器沙盒中，权限受限。要调用系统功能，路径如下：

1. **URL Schemes:** 如 `tel:`、`mailto:` 或 `weixin://`。
2. **Web APIs:** 现代浏览器支持的“黑科技”（HTTPS 环境下）：
   - `navigator.share()`: 原生分享。
   - `showOpenFilePicker()`: 文件系统读写。
   - `navigator.bluetooth`: 蓝牙连接。
3. **宿主扩展 (JSBridge):** * 在微信内使用 **JSSDK** 唤起扫一扫、选联系人。
   - 在 **Electron** 或 **Hybrid App** 中通过注入 Native 方法实现深度系统控制。

------

#### 💡 核心感悟

- **性能**不仅仅是执行速度，更是**资源利用的精确度**。
- **框架**是原生的动力外骨骼，它在牺牲极少物理性能的基础上，极大地提升了安全性和开发效率。
- **未来趋势：** 框架会越来越轻，浏览器原生 API 会越来越强。